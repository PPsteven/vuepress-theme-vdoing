(window.webpackJsonp=window.webpackJsonp||[]).push([[187],{742:function(e,t,s){"use strict";s.r(t);var r=s(24),a=Object(r.a)({},(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h3",{attrs:{id:"前言"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[e._v("#")]),e._v(" 前言")]),e._v(" "),s("p",[e._v("这是Pine Script 学习笔记的第二篇，简单挑教程上重要的记录了一下。")]),e._v(" "),s("h2",{attrs:{id:"context-switching-and-the-security-function"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#context-switching-and-the-security-function"}},[e._v("#")]),e._v(" Context switching and the security function")]),e._v(" "),s("p",[e._v("security 函数可以用于按照特定要求请求数据")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('//@version=4\nstudy("Example security 1", overlay=true)\nibm_15 = security("NYSE:IBM", "15", close)\nplot(ibm_15)\n')])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br")])]),s("p",[s("img",{attrs:{src:"https://www.tradingview.com/pine-script-docs/en/v4/_images/Chart_security_1.png",alt:""}})]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("security(symbol, resolution, expression, gaps, lookahead)\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("ul",[s("li",[s("p",[s("strong",[e._v("symbol (string)")]),e._v(" 商品代码。")]),e._v(" "),s("p",[e._v("商品代码可以包含数据提供商信息，也可以不含")]),e._v(" "),s("p",[e._v('如 "NYSE:IBM","BATS:IBM","IBM"(如不提供，默认使用BATS)')]),e._v(" "),s("p",[s("a",{attrs:{href:"https://www.tradingview.com/pine-script-reference/v4/#var_syminfo%7Bdot%7Dticker",target:"_blank",rel:"noopener noreferrer"}},[e._v("syminfo.ticker"),s("OutboundLink")],1),e._v(" and "),s("a",{attrs:{href:"https://www.tradingview.com/pine-script-reference/v4/#var_syminfo%7Bdot%7Dtickerid",target:"_blank",rel:"noopener noreferrer"}},[e._v("syminfo.tickerid"),s("OutboundLink")],1),e._v("是表示当前图标上的商品代码，syminfo.ticker是不含数据供应商信息，syminfo.tickerid是包含供应商信息。Pine教程建议使用后者，为了避免数据的模糊性")])]),e._v(" "),s("li",[s("p",[s("strong",[e._v("resolution (string)")]),e._v(" 分辨率/ "),s("strong",[e._v("timeframe")]),e._v("时间周期")]),e._v(" "),s("ul",[s("li",[e._v("分钟级：1，5，10，21，60，120，等等")]),e._v(" "),s("li",[e._v("日级: D,1D,2D 等等")]),e._v(" "),s("li",[e._v("周级：W，1W，2W")]),e._v(" "),s("li",[e._v("月级：M，1M，2M")]),e._v(" "),s("li",[e._v("timeframe.period 记录当前图标时间周期")])])]),e._v(" "),s("li",[s("p",[s("strong",[e._v("expression (series)")]),e._v(" 计数并从 "),s("a",{attrs:{href:"https://cn.tradingview.com/pine-script-reference/v3/#fun_security",target:"_blank",rel:"noopener noreferrer"}},[e._v("security"),s("OutboundLink")],1),e._v("调用返回的表达式。")]),e._v(" "),s("p",[e._v("如果仅仅是获取收盘价数据，我们可以用"),s("code",[e._v("security('EURUSD','D',close)")])]),e._v(" "),s("p",[e._v("但是，expression能给我们提供更加丰富的操作，比如，我们需要知道，EURUSD相对于GBPUSD 上涨的幅度")]),e._v(" "),s("div",{staticClass:"language-Pine line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('//@version=4\nstudy(title = "Advance Decline Ratio", shorttitle="ADR")\nratio(t1, t2, source) =>\n    s1 = security(t1, timeframe.period, source)\n    s2 = security(t2, timeframe.period, source)\n    s1 / s2\nplot(ratio("GBPUSD", "EURUSD", close-open))\n')])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br")])]),s("p",[s("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/PPsteven/pictures/img/20191102123145.png",alt:""}})]),e._v(" "),s("p",[e._v("如上图所以，GBPUSD上涨幅度/EURUSD 的上涨幅度我们可以很轻松的通过7行代码实现。在绝大多数情况下，两者是同比例变动，但是在某些特等情况下，变化是相反的。这对于研究这两种货币对的走势关系有很大的帮助。")])])]),e._v(" "),s("p",[e._v("在security数据应用到当前图表上的时候，有两个控制，一个是gaps，另一个是lookahead")]),e._v(" "),s("ul",[s("li",[s("p",[s("strong",[e._v("gaps (const bool)")]),e._v(" 默认值为"),s("a",{attrs:{href:"https://cn.tradingview.com/pine-script-reference/v3/#var_barmerge%7Bdot%7Dgaps_off",target:"_blank",rel:"noopener noreferrer"}},[e._v("barmerge.gaps_off"),s("OutboundLink")],1),e._v("。可以理解为数据平滑的操作，因为数据中会存在空值（na），在gaps_off的情况下，na会被离它最近的非空值所替代，也就不会出现间隔（gap）的情况")])]),e._v(" "),s("li",[s("p",[s("strong",[e._v("lookahead (const bool)")]),e._v(" 默认值为"),s("a",{attrs:{href:"https://cn.tradingview.com/pine-script-reference/v3/#var_barmerge%7Bdot%7Dlookahead_off",target:"_blank",rel:"noopener noreferrer"}},[e._v("barmerge.lookahead_off"),s("OutboundLink")],1),e._v("。")]),e._v(" "),s("p",[e._v("合并所请求数据位置的策略。 请求的条形图与当前的条形图按照k线开盘时间合并。 这种合并策略可能导致从“未来”获取数据计算历史的不良影响。 这在回溯测试策略中不被接受，但在指标中可使用。")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("//@version=4\nstudy('My Script', overlay=true)\na = security(syminfo.tickerid, '60', low, lookahead=barmerge.lookahead_off)\nplot(a, color=color.red)\nb = security(syminfo.tickerid, '60', low, lookahead=barmerge.lookahead_on)\nplot(b, color=color.lime)\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br")])]),s("p",[s("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/PPsteven/pictures/img/20191102163742.png",alt:""}})]),e._v(" "),s("p",[e._v("红色是lookahead_off，绿色是lookahead_on。 我们发现开启了lookahead功能后，所产生的最低价是整个时间段的最低价，而原先是开盘K点的最低价。")])])]),e._v(" "),s("h2",{attrs:{id:"bar-state-变量"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#bar-state-变量"}},[e._v("#")]),e._v(" bar state.* 变量")]),e._v(" "),s("ul",[s("li",[s("p",[e._v("barstate.isfirst  当前k线为k线组的第一条k线")])]),e._v(" "),s("li",[s("p",[e._v("barstate.islast  当前k线为k线组的最后一条k线")])]),e._v(" "),s("li",[s("p",[e._v("barstate.ishistory  当前k线为历史k线")])]),e._v(" "),s("li",[s("p",[e._v("batstate.isrealtime 当前k线为实时k线")])]),e._v(" "),s("li",[s("p",[e._v("barstate.isnew 新K线的第一次更新")])]),e._v(" "),s("li",[s("p",[e._v("batstate.isconfirmed =当前k线的最后(关闭)更新")]),e._v(" "),s("blockquote",[s("p",[e._v("不建议在"),s("a",{attrs:{href:"https://cn.tradingview.com/pine-script-reference/v3/#fun_security",target:"_blank",rel:"noopener noreferrer"}},[e._v("security"),s("OutboundLink")],1),e._v("表达式中使用"),s("a",{attrs:{href:"https://cn.tradingview.com/pine-script-reference/v3/#var_barstate%7Bdot%7Disconfirmed",target:"_blank",rel:"noopener noreferrer"}},[e._v("barstate.isconfirmed"),s("OutboundLink")],1)])])])]),e._v(" "),s("p",[e._v("所有的历史柱线都曾被认为是新的柱线，因为脚本是依次执行的。当柱线第一更开盘价生成的时候，认为此柱线是新的。")]),e._v(" "),s("h2",{attrs:{id:"会话和时间信息"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#会话和时间信息"}},[e._v("#")]),e._v(" 会话和时间信息")]),e._v(" "),s("p",[e._v("Pine 提供方法来生成 交易区间，时间和日期的信息。")]),e._v(" "),s("p",[e._v("time(变量): 返回的是时间戳格式")]),e._v(" "),s("p",[e._v("time(函数)：time(resolution, session) → series 返回的是按照session 格式返回的时间，如果不在session时间段的话便会返回na值")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('//@version=4\nstudy("Time", overlay=true)\nt1 = time(timeframe.period, "0000-0000")\nbgcolor(t1 ? color.blue : na)\n')])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br")])]),s("p",[e._v('session = "0000-0000:23456" 即24h，去除周六日，运行结果如下')]),e._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/PPsteven/pictures/img/20191102203555.png",alt:""}})]),e._v(" "),s("p",[e._v("可以看到，周一至周五背景都变成了蓝色，因为t1 不在session的范围内的时候返回na值")]),e._v(" "),s("p",[e._v("交易区间的格式有")]),e._v(" "),s("ul",[s("li",[s("p",[e._v("0000-0000:1234567 24小时交易，时间从午夜0点开始")])]),e._v(" "),s("li",[s("p",[e._v("0000-0000:23456 工作日24小时交易")])]),e._v(" "),s("li",[s("p",[e._v("1700-1700：24小时交易，时间从17点开始")])]),e._v(" "),s("li",[s("p",[e._v("0930-1700:146  交易时间为09:30~17:00，交易时间在周日（1），周三（4），周五（6）")])]),e._v(" "),s("li",[s("p",[e._v("24x7 等价于 0000-0000:1234567")])])]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('// 判断是否为30min的新柱线\n//@version=4\nstudy("new 30 min bar")\nis_newbar(res) =>\n    t = time(res)\n    not na(t) and (na(t[1]) or t > t[1])\nplot(is_newbar("30") ? 1 : 0)\n')])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br")])]),s("p",[e._v("用到的函数变量和类型")]),e._v(" "),s("ul",[s("li",[e._v("time：UNIX格式的当前k线时间")]),e._v(" "),s("li",[e._v("timenow：UNIX格式的当前时间")]),e._v(" "),s("li",[e._v("syminfo.timezone：时区")])]),e._v(" "),s("p",[e._v("当前K线用到的变量")]),e._v(" "),s("ul",[s("li",[e._v("year/month/weekofyear")]),e._v(" "),s("li",[e._v("dayofmonth")]),e._v(" "),s("li",[e._v("dayofweek（sunday,monday 等）")]),e._v(" "),s("li",[e._v("hour/minute/second")])]),e._v(" "),s("p",[e._v("创建时间")]),e._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://www.tradingview.com/pine-script-reference/v4/#fun_timestamp",target:"_blank",rel:"noopener noreferrer"}},[e._v("timestamp(year, month, day, hour, minute)"),s("OutboundLink")],1)])]),e._v(" "),s("h2",{attrs:{id:"策略编写"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#策略编写"}},[e._v("#")]),e._v(" 策略编写")]),e._v(" "),s("h3",{attrs:{id:"backtesting-forwardtesting"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#backtesting-forwardtesting"}},[e._v("#")]),e._v(" backtesting & forwardtesting")]),e._v(" "),s("p",[e._v("strategy脚本是可以产生交易订单的Pine 脚本。利用strategy 可以做策略回测（backtesting）和 模拟交易（forwardtesting）")]),e._v(" "),s("p",[e._v("无论backtesting 还是forwardtesting，计算都是**"),s("u",[e._v("默认")]),e._v("**发生在K线收盘的时候，但是在forwardtesting 的时候，可以选择在每一个tick发生的时候，都运行一次。")]),e._v(" "),s("p",[e._v("做法一是调整strategy的 Setting/Properties，或者修改代码，添加"),s("code",[e._v("strategy(... ,calc_on_every_tick=true )")]),e._v(" ，此外还可以选择在每笔订单完成之后计算"),s("code",[e._v("strategy(... , calc_on_order_fills=true)")])]),e._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/PPsteven/pictures/img/20191102215042.png",alt:""}})]),e._v(" "),s("h3",{attrs:{id:"经纪商模拟"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#经纪商模拟"}},[e._v("#")]),e._v(" 经纪商模拟")]),e._v(" "),s("p",[e._v("仅仅只有OHLC数据的话，K线内数据的生成有一套逻辑，如果最高价更接近开盘价，生成顺序是 open->high->low->close，此外还假设价格是没有gaps的")]),e._v(" "),s("h3",{attrs:{id:"订单生成命令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#订单生成命令"}},[e._v("#")]),e._v(" 订单生成命令")]),e._v(" "),s("h4",{attrs:{id:"strategy-entry-订单生成函数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#strategy-entry-订单生成函数"}},[e._v("#")]),e._v(" strategy.entry 订单生成函数")]),e._v(" "),s("p",[e._v("这是进入市场的命令。 如果具有相同ID的订单已经挂起，则可修改订单。 如果没有指定ID的订单，则会发出新的订单。")]),e._v(" "),s("p",[e._v("要取消/停用预挂单，应使用命令"),s("a",{attrs:{href:"https://cn.tradingview.com/pine-script-reference/v4/#fun_strategy%7Bdot%7Dcancel",target:"_blank",rel:"noopener noreferrer"}},[e._v("strategy.cancel"),s("OutboundLink")],1),e._v("或"),s("a",{attrs:{href:"https://cn.tradingview.com/pine-script-reference/v4/#fun_strategy%7Bdot%7Dcancel_all",target:"_blank",rel:"noopener noreferrer"}},[e._v("strategy.cancel_all"),s("OutboundLink")],1),e._v("。")]),e._v(" "),s("p",[e._v("与函数"),s("a",{attrs:{href:"https://cn.tradingview.com/pine-script-reference/v4/#fun_strategy%7Bdot%7Dorder",target:"_blank",rel:"noopener noreferrer"}},[e._v("strategy.order"),s("OutboundLink")],1),e._v("相比，"),s("a",{attrs:{href:"https://cn.tradingview.com/pine-script-reference/v4/#fun_strategy%7Bdot%7Dentry",target:"_blank",rel:"noopener noreferrer"}},[e._v("strategy.entry"),s("OutboundLink")],1),e._v("功能受金字塔影响，可以正确反转市场位置。 如果“Limit”和“stop”参数均为“NaN”，则订单类型为市场订单。")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("strategy.entry(id, long, qty, limit, stop, oca_name, oca_type, comment, when) → void\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("h4",{attrs:{id:"strategy-exit-订单退出函数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#strategy-exit-订单退出函数"}},[e._v("#")]),e._v(" strategy.exit 订单退出函数")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("strategy.exit(id, from_entry, qty, qty_percent, profit, limit, loss, stop, trail_price, trail_points, trail_offset, oca_name, comment, when) → void\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("p",[e._v("这是一个退出指定进场或整个市场地位的命令，重点区分它和strategy.close 的不同")]),e._v(" "),s("ul",[s("li",[e._v("id(string): 订单的标识符。")]),e._v(" "),s("li",[e._v("from_entry(string): 这里填入要平仓的订单的标识符，默认为空。")]),e._v(" "),s("li",[e._v("qty: 平仓手数(弄清楚合约的大小)")]),e._v(" "),s("li",[e._v("qty_percent: 平台的比例")]),e._v(" "),s("li",[e._v("profit: 获利点数(一定搞清楚单位是点还是步)")]),e._v(" "),s("li",[e._v("limit: 与profit 相似，limit约定获利的价格")]),e._v(" "),s("li",[e._v("loss:止损点数")]),e._v(" "),s("li",[e._v("stop:与loss 相似，stop约定止损的价格")]),e._v(" "),s("li",[e._v("tail.*: 指明跟踪指数")])]),e._v(" "),s("h4",{attrs:{id:"strategy-order"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#strategy-order"}},[e._v("#")]),e._v(" strategy.order")]),e._v(" "),s("p",[e._v("这条命令可以生成开仓也可以生成平仓命令，但是它不受金字塔影响。它的作用就是弥补strategy.entry 和 strategy.exit 函数的不灵活星。")]),e._v(" "),s("h4",{attrs:{id:"实例"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#实例"}},[e._v("#")]),e._v(" 实例")]),e._v(" "),s("p",[e._v("下面是几个例子，可以帮助我们理解strategy函数")]),e._v(" "),s("h5",{attrs:{id:"例1"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#例1"}},[e._v("#")]),e._v(" 例1")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('//@version=4\nstrategy("revers demo")\nif bar_index > 4000\n    strategy.entry("buy", strategy.long, 4, when=strategy.position_size <= 0)\n    strategy.entry("sell", strategy.short, 6, when=strategy.position_size > 0)\nplot(strategy.equity)\n')])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br")])]),s("p",[s("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/PPsteven/pictures/img/20191103235510.png",alt:""}})]),e._v(" "),s("p",[e._v("当仓位为空头或者无头寸的话，买4。当仓位为多头的话，卖6。")]),e._v(" "),s("p",[e._v("我们可以看到entry中buy 或sell 在交易的时候，会自动平仓，平掉反向的仓位。仓位在+4 --\x3e -6 变化。")]),e._v(" "),s("h5",{attrs:{id:"例2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#例2"}},[e._v("#")]),e._v(" 例2")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('//@version=4\nstrategy("Partial exit demo")\nif bar_index > 6500 and bar_index <6550\n    strategy.entry("buy", strategy.long, 40000, when=strategy.position_size <= 0)\nstrategy.exit("bracket1", "buy",  20000, profit = 3000,loss = 3000)\nstrategy.exit("bracket2", "buy",  profit=2000, loss=2000)\nplot(strategy.equity)\n')])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br")])]),s("p",[e._v("盈亏曲线")]),e._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/PPsteven/pictures/img/20191104151143.png",alt:""}})]),e._v(" "),s("p",[e._v("交易逻辑")]),e._v(" "),s("ul",[s("li",[e._v("buy：当空仓时候买入，40000笔合约（40000美金）")]),e._v(" "),s("li",[e._v("bracket1：设定平仓对象为buy标识的交易，平仓2000美金，止盈300点（单位为步，3000步=300点）。止损300点")]),e._v(" "),s("li",[e._v("bracket2：止盈止损200点")])]),e._v(" "),s("p",[e._v("下面结合交易清单具体分析")]),e._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/PPsteven/pictures/img/20191104215413.png",alt:""}})]),e._v(" "),s("ul",[s("li",[e._v("1：空仓买入4000美金")]),e._v(" "),s("li",[e._v("2：止损200点，亏损20000 * 200 * 0.0001 = $ 400，从图中可以看到是bracket2 先止损")]),e._v(" "),s("li",[e._v("3：价格继续向下，亏损300点，bracket1策略触发，亏损$ 600")]),e._v(" "),s("li",[e._v("4,5,6:同上逻辑")])]),e._v(" "),s("h3",{attrs:{id:"风险管理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#风险管理"}},[e._v("#")]),e._v(" 风险管理")]),e._v(" "),s("p",[e._v("strategy.risk.* 一系列函数，可以帮助进行风险管理。当风险管理规则被激活的时候，没有订单会生成。")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('//@version=4\nstrategy("multi risk demo", overlay=true, pyramiding=10, calc_on_order_fills = true)\nif year > 2014\n    strategy.entry("LE", strategy.long)\nstrategy.risk.max_intraday_filled_orders(5)\nstrategy.risk.max_intraday_filled_orders(2)\n')])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br")])]),s("ul",[s("li",[s("p",[e._v("strategy.risk.max_intraday_filled_orders(2)")]),e._v(" "),s("p",[e._v("限制一天成交的最大的交易单数，一旦达到，所有未成交订单全部取消，成交订单关闭。并且一直关闭交易直到本交易日结束。")]),e._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/PPsteven/pictures/img/20191104172514.png",alt:""}})]),e._v(" "),s("p",[e._v("上图中，当第二笔交易生成的时候，同时也是两笔交易关闭的时间。")])]),e._v(" "),s("li",[s("p",[e._v("其余的函数参考手册")])])]),e._v(" "),s("h2",{attrs:{id:"指标重绘"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#指标重绘"}},[e._v("#")]),e._v(" 指标重绘")]),e._v(" "),s("p",[e._v("历史数据仅仅包含OHLC，不包含线内的运动。这会导致的问题是，历史数据上的回测和实时数据不一致的情况。")]),e._v(" "),s("p",[e._v("另外一个担心是，未来函数的使用。这里尤其要关注security 函数，此函数可能会错误的引入未来的信息。")]),e._v(" "),s("h2",{attrs:{id:"绘图"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#绘图"}},[e._v("#")]),e._v(" 绘图")]),e._v(" "),s("p",[e._v("Pine V4 中存在两种绘图类型：label 和 line。")]),e._v(" "),s("blockquote",[s("p",[e._v("注：用户的绘图和 编程绘图是不一样的，编程得到的绘图是不能用鼠标修改的。")])]),e._v(" "),s("p",[e._v("和指标绘图函数(plot,plotshape,plotchar) 不一样的是，绘图函数可以在图表右侧没有K线的地方。")]),e._v(" "),s("h3",{attrs:{id:"label"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#label"}},[e._v("#")]),e._v(" label")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("label.new(x, y, text, xloc, yloc, color, style, textcolor, size) → series[label]\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('//@version=4\nstudy("My Script", overlay=true)\nlabel.new(bar_index, high, style=label.style_none,\n          text="x=" + tostring(bar_index) + "\\ny=" + tostring(high))\n')])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br")])]),s("p",[s("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/PPsteven/pictures/img/20191104175710.png",alt:""}})]),e._v(" "),s("ul",[s("li",[s("p",[e._v("x的位置是用bar_index 标识的，此时xloc 的默认值为xloc.barindex")])]),e._v(" "),s("li",[s("p",[e._v("y的位置是最高价")])]),e._v(" "),s("li",[s("p",[e._v("xloc取值：xloc.bar_index(默认) 和 xloc.bar_time")])]),e._v(" "),s("li",[s("p",[e._v("yloc取值：")]),e._v(" "),s("ul",[s("li",[s("p",[e._v("yloc.price 传入此函数，需要输入y值")])]),e._v(" "),s("li",[s("p",[e._v("yloc.abovebar,yloc.belowbar 启动时，y值会失效。标签在图表上部或者下部")])])])]),e._v(" "),s("li",[s("p",[e._v("style: 很多种，可能用到比较多的有label.style_none，无底色")])])]),e._v(" "),s("p",[e._v("label.set_* 一系列函数可以用来对对象进一步的修改。")]),e._v(" "),s("h3",{attrs:{id:"line"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#line"}},[e._v("#")]),e._v(" line")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("line.new(x1, y1, x2, y2, xloc, extend, color, style, width) → series[line]\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("ul",[s("li",[e._v("extend: extend.none/extend.right/extend.left")])])])}),[],!1,null,null,null);t.default=a.exports}}]);