(window.webpackJsonp=window.webpackJsonp||[]).push([[73],{607:function(s,a,t){"use strict";t.r(a);var n=t(24),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("p",[s._v("家中闲置了一台电脑，准备用来当做服务器。一方面也是作为linux 学习练练手，二是可以运行一些爬虫小程序或者是网页服务。")]),s._v(" "),t("p",[s._v("这里我用的manjaro，这是目前比较流行的linux 发行版，最热门的linux桌面发行版之一。")]),s._v(" "),t("p",[s._v("我选择manjaro也是想作为替代windows 来用。manjaro拥有一个非常方便的软件仓库，利用pacman和yay等命令可以十分方便的安装软件。")]),s._v(" "),t("p",[s._v("家中的电脑，由于没有公网ip，只能在家中用ssh 访问，一旦出门，就无法访问服务器了。这非常不方便，因为可能要从电脑上获取资料，访问数据库，修改代码等等操作，一旦离开本地环境，也太不方便了。")]),s._v(" "),t("p",[s._v("经过百度后发现，需要利用  "),t("strong",[s._v("内网穿透")]),s._v(" 技术实现。 原因是我们的ip资源是稀缺的，我们普通家庭中使用的ip都是动态分配的ip地址。没有固定的ip的服务器是无法与外网连接的，所以我们至少需要一个公网ip。")]),s._v(" "),t("p",[s._v("内网穿透技术有很多了，我这里选择的是ngrok 这个方案。\n我试了一下两种方案，第一个是外国的ngrok，没有尝试成功，而且免费版本每次断开后，生成的url 是随机的。所以没有采用。第二个是国内的Sunny-Ngrok，有免费版的。先尝试一波。")]),s._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://dashboard.ngrok.com/get-started",target:"_blank",rel:"noopener noreferrer"}},[s._v("ngrok"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"https://www.ngrok.cc/download.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("ngrok.cc"),t("OutboundLink")],1),s._v("  （Sunny-Ngrok）")])]),s._v(" "),t("blockquote",[t("p",[s._v("使用Sunny-Ngrok一个很大的好处就是在当你没有服务器和公网ip的时候，它会是一个很不错的解决方案。当然若是你有服务器的话，自己搭一个ngrok未尝不是一个很好的选择。")])]),s._v(" "),t("h2",{attrs:{id:"局域网连接服务器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#局域网连接服务器"}},[s._v("#")]),s._v(" 局域网连接服务器")]),s._v(" "),t("p",[s._v("这里先给出用局域网连接服务器的方法")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# linux 查看ip 地址一般是下面三种方法（不同系统不一样）")]),s._v("\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ifconfig")]),s._v("\n$ ipconfig\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" addr "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# <--manjaro")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("运行如下")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" addr "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" inet\n    inet "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1/8 scope "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v(" lo\n    inet6 ::1/128 scope "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v("\n    inet "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.102/24 brd "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.255 scope global dynamic noprefixroute wlp2s0\n    inet6 fe80::1bd5:9435:6572:ffc7/64 scope "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("link")]),s._v(" noprefixroute\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ip地址是 192.168.1.102")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("局域网中使用")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" -p "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(" ppsteven@192.168.1.l02\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -p 22 也可以省略，因为ssh 的默认端口号就是22 ")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h2",{attrs:{id:"sunny-ngrok教程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#sunny-ngrok教程"}},[s._v("#")]),s._v(" Sunny-Ngrok教程")]),s._v(" "),t("p",[s._v("教程基本上都在 "),t("a",{attrs:{href:"http://www.ngrok.cc/_book/general/tcp.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("ngrok.cc官方文档"),t("OutboundLink")],1),s._v(" 写的很清楚了，但是有一些还是需要注意的。")]),s._v(" "),t("h3",{attrs:{id:"开通隧道"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#开通隧道"}},[s._v("#")]),s._v(" 开通隧道")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/PPsteven/pictures/img/20191201135321.png",alt:""}})]),s._v(" "),t("p",[s._v("如果你是想用ssh，开通的就是TCP转发。记得要把本地端口换成22（当然不换也是可以的，只要你最后连ssh 的时候设置好端口就行了）")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/PPsteven/pictures/img/20191201135519.png",alt:""}})]),s._v(" "),t("p",[s._v("最后看到的结果是这样的")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/PPsteven/pictures/img/20191201153141.png",alt:""}})]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" -p "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10568")]),s._v(" yourname@free.aa.com 就可以连接上你的服务器了\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"ngrok-启动"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ngrok-启动"}},[s._v("#")]),s._v(" Ngrok 启动")]),s._v(" "),t("p",[s._v("上图可以看到，在状态栏显示 是否成功开启ngrok")]),s._v(" "),t("p",[s._v("启动的方法，官网教程里面也有写，本人按照流程走一遍。")]),s._v(" "),t("h3",{attrs:{id:"下载客户端"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#下载客户端"}},[s._v("#")]),s._v(" 下载客户端")]),s._v(" "),t("p",[s._v("我用的是Mac 下载zip文件，然后上传到服务器的操作。有图形界面的同学，可以直接按照官网操作。")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("scp")]),s._v(" ~/Downloads/linux_amd64.zip ppsteven@192.168.1.102:~/Documents\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.102\n$ "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" ~/Documents\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("unzip")]),s._v(" linux_amd64.zip\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h3",{attrs:{id:"启动ngrok-服务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#启动ngrok-服务"}},[s._v("#")]),s._v(" 启动ngrok 服务")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 当前目录在linux_amd64 下")]),s._v("\n$ ./sunny clientid 隧道id  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动隧道服务")]),s._v("\n$ setsid ./sunny clientid 743acXXXX "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在后台启动隧道服务")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("启动服务后，我们在官网的后端就可以看到结果。\n为了让我们的服务器能不断的在后台运行，我们需要登录服务器后，运行第二行的命令")]),s._v(" "),t("ul",[t("li",[s._v("& 作用是后台运行程序")]),s._v(" "),t("li",[s._v("setsid 作用是当终端关闭的时候命令一直不会关闭")])]),s._v(" "),t("h3",{attrs:{id:"高级教程-开机自动运行"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#高级教程-开机自动运行"}},[s._v("#")]),s._v(" 高级教程——开机自动运行")]),s._v(" "),t("p",[s._v("官网中已经给出了 "),t("a",{attrs:{href:"http://www.ngrok.cc/_book/start/ngrok_auto.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("Ngrok开机自启动"),t("OutboundLink")],1),s._v(" 的教程，我们这里由于使用的是manjaro，官网的教程无法直接参考，我们这里给出自己的解决方案。")]),s._v(" "),t("h4",{attrs:{id:"第一步：移动命令，并使之可执行"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#第一步：移动命令，并使之可执行"}},[s._v("#")]),s._v(" 第一步：移动命令，并使之可执行")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" sunny /usr/local/bin/sunny\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" +x /usr/local/bin/sunny\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h4",{attrs:{id:"第二步：编写启动脚本"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#第二步：编写启动脚本"}},[s._v("#")]),s._v(" 第二步：编写启动脚本")]),s._v(" "),t("p",[s._v("我们这里直接上手修改官网的shell语言")]),s._v(" "),t("p",[s._v("sunny_auto.sh")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/bin/bash -e")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("### BEGIN INIT INFO")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Provides:          ngrok.cc")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Required-Start:    $network $remote_fs $local_fs")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Required-Stop:     $network $remote_fs $local_fs")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Default-Start:     2 3 4 5")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Default-Stop:      0 1 6")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Short-Description: autostartup of ngrok for Linux")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("### END INIT INFO")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("NAME")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("sunny\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DAEMON")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/bin/"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$NAME")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("PIDFILE")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/run/"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$NAME")]),s._v(".pid\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 判断 sunny 是否可执行")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" -x "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$DAEMON")]),s._v('"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("case")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v('"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v("\n  start"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 根据/var/run/sunny.pid 文件判断sunny是否正在运行")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" -f "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$PIDFILE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v(" \n        "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$NAME")]),s._v(' already running..."')]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" -e "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token entity",title:"\\033"}},[s._v("\\033")]),s._v("[1;35mStart Fail"),t("span",{pre:!0,attrs:{class:"token entity",title:"\\033"}},[s._v("\\033")]),s._v('[0m"')]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Starting '),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$NAME")]),s._v('..."')]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# start-stop-daemon -S -p $PIDFILE -m -b -o -q -x $DAEMON -- clientid 隧道id || return 2")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 不使用start-stop-daemon，使用常规的方法后台运行")]),s._v("\n        setsid sunny clientid 1cb52410136cfe34 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" -e "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token entity",title:"\\033"}},[s._v("\\033")]),s._v("[1;32mStart Success"),t("span",{pre:!0,attrs:{class:"token entity",title:"\\033"}},[s._v("\\033")]),s._v('[0m"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  stop"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Stoping '),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$NAME")]),s._v('..."')]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# start-stop-daemon -K -p $PIDFILE -s TERM -o -q || return 2")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# pkill 是 kill 和 pgrep 的结合，删除所有中带sunny的进程")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("pkill")]),s._v(" -9 sunny \n        "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -rf "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$PIDFILE")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" -e "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token entity",title:"\\033"}},[s._v("\\033")]),s._v("[1;32mStop Success"),t("span",{pre:!0,attrs:{class:"token entity",title:"\\033"}},[s._v("\\033")]),s._v('[0m"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  restart"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$0")]),s._v(" stop "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$0")]),s._v(" start\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  *"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Usage: '),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$0")]),s._v(' {start|stop|restart}"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("esac")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br")])]),t("p",[s._v("写完之后，我们需要测试一下")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" a+x sunny_auto.sh\n./sunny_auto.sh "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 会输出使用方法")]),s._v("\n./sunny_auto.sh start \n./sunny_auto.sh stop\n./sunny_auto.sh restart\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("测试成功后，我们需要让系统自己启动。我看了一下，目前网上大部分教程都是直接给了代码，并没有解释清楚自启动的原理。我认为这是可以通过查看官方教程一步步讲清楚的。抱着**“授人以鱼不如授人以渔”** 的态度，我准备写的仔细一点。")]),s._v(" "),t("h4",{attrs:{id:"第三步：自动跑起来"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#第三步：自动跑起来"}},[s._v("#")]),s._v(" 第三步：自动跑起来")]),s._v(" "),t("p",[s._v("我们的系统是manjaro，是arch linux 的衍生版本，所以我们第一想到的就是去 "),t("a",{attrs:{href:"https://www.archlinux.org/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://wiki.archlinux.org/"),t("OutboundLink")],1),s._v(" 上找。")]),s._v(" "),t("p",[s._v('archlinux 上，在如下九个方面，我们可以完成"autostart" 操作')]),s._v(" "),t("ul",[t("li",[s._v("开关机")]),s._v(" "),t("li",[s._v("登录登出")]),s._v(" "),t("li",[s._v("插入拔出设备")]),s._v(" "),t("li",[s._v("计时事件")]),s._v(" "),t("li",[s._v("文件系统事件")]),s._v(" "),t("li",[s._v("shell登录登出")]),s._v(" "),t("li",[s._v("Xorg")]),s._v(" "),t("li",[s._v("桌面环境")]),s._v(" "),t("li",[s._v("窗口管理启动")])]),s._v(" "),t("p",[s._v("这里，我们需要第一项开关机 "),t("a",{attrs:{href:"https://wiki.archlinux.org/index.php/Systemd_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)",target:"_blank",rel:"noopener noreferrer"}},[s._v("Systemd"),t("OutboundLink")],1),s._v(" 作为我们自启动的方式，其实很多教程中也是采用的这个方式。")]),s._v(" "),t("h5",{attrs:{id:"单元文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#单元文件"}},[s._v("#")]),s._v(" 单元文件")]),s._v(" "),t("p",[s._v("一个服务可以看做是一个unit，每个unit需要编写自己的单元文件。"),t("code",[s._v("systemd")]),s._v(" "),t("a",{attrs:{href:"https://www.freedesktop.org/software/systemd/man/systemd.unit.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("单元文件"),t("OutboundLink")],1),s._v("的语法来源于 XDG 桌面项配置文件"),t("code",[s._v(".desktop")]),s._v("文件，最初的源头则是Microsoft Windows的"),t("code",[s._v(".ini")]),s._v("文件。")]),s._v(" "),t("h5",{attrs:{id:"单元文件操作"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#单元文件操作"}},[s._v("#")]),s._v(" 单元文件操作")]),s._v(" "),t("p",[s._v("立即激活单元：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("# systemctl start <单元>\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("立即停止单元：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("# systemctl stop <单元>\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("重启单元：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("# systemctl restart <单元>\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("重新加载配置：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("# systemctl reload <单元>\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("输出单元运行状态：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("$ systemctl status <单元>\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("检查单元是否配置为自动启动：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("$ systemctl is-enabled <单元>\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("开机自动激活单元：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("# systemctl enable <单元>\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("设置单元为自动启动并立即启动这个单元:")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("# systemctl enable --now unit\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("取消开机自动激活单元：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("# systemctl disable <单元>\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h5",{attrs:{id:"编辑我们的单元文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#编辑我们的单元文件"}},[s._v("#")]),s._v(" 编辑我们的单元文件")]),s._v(" "),t("p",[s._v("单元文件的语法，可以参考系统已经安装的单元，也可以参考 "),t("a",{attrs:{href:"https://jlk.fjfi.cvut.cz/arch/manpages/man/systemd.service.5",target:"_blank",rel:"noopener noreferrer"}},[s._v("systemd.service(5)"),t("OutboundLink")],1),s._v(" 中的"),t("a",{attrs:{href:"https://www.freedesktop.org/software/systemd/man/systemd.service.html#Examples",target:"_blank",rel:"noopener noreferrer"}},[s._v("EXAMPLES章节"),t("OutboundLink")],1),s._v("。英文不好的同学，有一位热心的大牛，已经写好了中文教程 "),t("a",{attrs:{href:"http://www.jinbuguo.com/systemd/systemd.index.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("systemd.index 中文手册"),t("OutboundLink")],1)]),s._v(" "),t("p",[s._v("单元文件的地址如下")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("/usr/lib/systemd/system/")]),s._v(" ：软件包安装的单元")]),s._v(" "),t("li",[t("code",[s._v("/etc/systemd/system/")]),s._v(" ：系统管理员安装的单元")])]),s._v(" "),t("p",[s._v("从网上的教程看下来，大家最喜欢的一个做法就是创建一个"),t("code",[s._v("rc.local")]),s._v(" 文件，和一个"),t("code",[s._v("rc-local.service")]),s._v(" 服务。然后把我们需要运行的脚本加入"),t("code",[s._v("rc.local")]),s._v("中。")]),s._v(" "),t("p",[s._v("我认为这样的做法很省事，也比较简单，不过缺点是所有的开机自启服务都放一起了，比较乱不好管理。这里我准备按照自己的想法来创建一个服务，我这里借鉴了docker.service。")]),s._v(" "),t("p",[s._v("sunny.service")]),s._v(" "),t("div",{staticClass:"language-ini line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-ini"}},[t("code",[t("span",{pre:!0,attrs:{class:"token selector"}},[s._v("[Unit]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("Description")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v("ngrok sunny")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token selector"}},[s._v("[Service]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("Type")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v("forking")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("User")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v("ppsteven")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 自动重启服务")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Restart=always")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# RestartSec=30")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 执行命令")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("Restart")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v("on-failure")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ExecStart")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v("/etc/sunny.sh start")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ExecStop")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v("/etc/sunny.sh stop")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ExecReload=/bin/kill -s HUP $MAINPID")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token selector"}},[s._v("[Install]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("WantedBy")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v("multi-user.target")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br")])]),t("h3",{attrs:{id:"连接远程服务器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#连接远程服务器"}},[s._v("#")]),s._v(" 连接远程服务器")]),s._v(" "),t("p",[s._v("ngrok 的作用直观的来说，就是给我们提供了一个公网ip，使我们可以访问内网地址。\nngrok的作用就是，将我们传给www.abc.com:12345 的端口转发给我们本地服务器127.0.0.1:22端口上，实现了ssh功能。")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" -p "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12345")]),s._v(" yourname@www.abc.com \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"zshrc-配置小结"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#zshrc-配置小结"}},[s._v("#")]),s._v(" .zshrc 配置小结")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("alias")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("localDell")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ssh ppsteven@192.168.1.102"')]),s._v("\n$ "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("alias")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("remoteDell")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ssh -p 10568 yourname@free.aa.com"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h2",{attrs:{id:"参考资料"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#参考资料"}},[s._v("#")]),s._v(" 参考资料")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/91684175",target:"_blank",rel:"noopener noreferrer"}},[s._v("有了内网穿透神器 ngrok ，个人电脑也能做服务器"),t("OutboundLink")],1)])])}),[],!1,null,null,null);a.default=e.exports}}]);