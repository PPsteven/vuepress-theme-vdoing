---
title: SQLä¼˜åŒ–--Explain
tags: 
  - SQL
date: 2022-06-10 11:19:58
permalink: /pages/d2d9a2/
categories: 
  - åç«¯
  - DB
---

## Explain è¾“å‡ºè¯¦è§£

#### Explain Output Columns

| Column                                                       | JSON Name       | Meaning                                               | eg   |
| :----------------------------------------------------------- | :-------------- | :---------------------------------------------------- | ---- |
| [`id`](https://dev.mysql.com/doc/refman/8.0/en/explain-output.html#explain_id) | `select_id`     | æ¯ä¸ªselectå­å¥çš„æ ‡è¯†id                                |      |
| [`select_type`](https://dev.mysql.com/doc/refman/8.0/en/explain-output.html#explain_select_type) | None            | selectè¯­å¥çš„ç±»å‹                                      |      |
| [`table`](https://dev.mysql.com/doc/refman/8.0/en/explain-output.html#explain_table) | `table_name`    | å½“å‰è¡¨å                                              |      |
| [`partitions`](https://dev.mysql.com/doc/refman/8.0/en/explain-output.html#explain_partitions) | `partitions`    | åŒ¹é…çš„åˆ†åŒº                                            |      |
| [`type`](https://dev.mysql.com/doc/refman/8.0/en/explain-output.html#explain_type) | `access_type`   | å½“å‰è¡¨å†…è®¿é—®æ–¹å¼ join type                            |      |
| [`possible_keys`](https://dev.mysql.com/doc/refman/8.0/en/explain-output.html#explain_possible_keys) | `possible_keys` | å¯èƒ½ä½¿ç”¨åˆ°çš„ç´¢å¼•                                      |      |
| [`key`](https://dev.mysql.com/doc/refman/8.0/en/explain-output.html#explain_key) | `key`           | ç»è¿‡ä¼˜åŒ–å™¨è¯„ä¼°æœ€ç»ˆä½¿ç”¨çš„ç´¢å¼•                          |      |
| [`key_len`](https://dev.mysql.com/doc/refman/8.0/en/explain-output.html#explain_key_len) | `key_length`    | The length of the chosen key                          |      |
| [`ref`](https://dev.mysql.com/doc/refman/8.0/en/explain-output.html#explain_ref) | `ref`           | æ ¹æ®ç´¢å¼•åº”ç”¨åˆ°çš„åˆ—ï¼ˆå…³è”å¤–è¡¨ï¼‰                        |      |
| [`rows`](https://dev.mysql.com/doc/refman/8.0/en/explain-output.html#explain_rows) | `rows`          | Estimate of rows to be examinedï¼Œä¼°è®¡çœŸå®æ‰«æåˆ°çš„è¡Œæ•° |      |
| [`filtered`](https://dev.mysql.com/doc/refman/8.0/en/explain-output.html#explain_filtered) | `filtered`      | æ ¹æ®æ¡ä»¶è¿‡æ»¤æ‰çš„ç™¾åˆ†æ¯”                                |      |
| [`Extra`](https://dev.mysql.com/doc/refman/8.0/en/explain-output.html#explain_extra) | None            | é¢å¤–è¯´æ˜                                              |      |

### Each Explain Column Detail

#### 1.id

SELECTçš„åºå·ï¼ŒæŸ¥è¯¢åºå·æ˜¯SQLæ‰§è¡Œè¯­å¥çš„é¡ºåºã€‚

#### 2.select_type

SELECTç±»å‹æœ‰

| `select_type` Value    | JSON Name                    | Meaning                                                      |
| :--------------------- | :--------------------------- | :----------------------------------------------------------- |
| `SIMPLE`               | None                         | ç®€å•æŸ¥è¯¢ï¼ˆæ— UNIONå’Œå­æŸ¥è¯¢ï¼‰                                  |
| `PRIMARY`              | None                         | æœ€å¤–å±‚çš„SELECT                                               |
| `UNION`                | None                         | UNIONæ“ä½œä¸­ï¼ŒæŸ¥è¯¢ä¸­å¤„äºå†…å±‚çš„SELECTï¼Œä¸”ä¸å¤–å±‚SELECT**ç‹¬ç«‹**  |
| `DEPENDENT UNION`      | `dependent` (`true`)         | UNIONæ“ä½œä¸­ï¼ŒæŸ¥è¯¢ä¸­å¤„äºå†…å±‚çš„SELECTï¼Œä¸”ä¸å¤–å±‚SELECT**ä¾èµ–**  |
| `UNION RESULT`         | `union_result`               | UNIONçš„ç»“æœï¼Œå¯¹åº”IDä¸ºNULL                                    |
| `SUBQUERY`             | None                         | å­æŸ¥è¯¢çš„ç¬¬ä¸€ä¸ªSELECT                                         |
| `DEPENDENT SUBQUERY`   | `dependent` (`true`)         | å­æŸ¥è¯¢ä¸­é¦–ä¸ªSELECTï¼Œä½†ä¾èµ–äºå¤–å±‚çš„è¡¨ï¼ˆå¦‚æœæœ‰å¤šä¸ªå­æŸ¥è¯¢å­˜åœ¨ï¼‰ |
| `DERIVED`              | None                         | Derived table                                                |
| `DEPENDENT DERIVED`    | `dependent` (`true`)         | Derived tableï¼Œä¾èµ–å¦å¤–çš„è¡¨                                  |
| `MATERIALIZED`         | `materialized_from_subquery` | Materialized å­æŸ¥è¯¢                                          |
| `UNCACHEABLE SUBQUERY` | `cacheable` (`false`)        | æ— æ³•ç¼“å­˜çš„å­æŸ¥è¯¢                                             |
| `UNCACHEABLE UNION`    | `cacheable` (`false`)        | Unionæ“ä½œä¸­ï¼Œæ— æ³•ç¼“å­˜çš„å­æŸ¥è¯¢                                |

**è§†å›¾ï¼ˆViewï¼‰** ï¼šè™šæ‹Ÿçš„æ•°æ®åº“å…³ç³»ï¼Œè§†å›¾ä¸æ˜¯æ•°æ®åº“ç³»ç»Ÿå­˜å‚¨çš„çœŸå®é€»è¾‘å…³ç³»ï¼Œæ¯æ¬¡è§†å›¾è®¿é—®çš„æ—¶å€™éƒ½ä¼šå®æ—¶ç”Ÿæˆã€‚

**ç‰©åŒ–è§†å›¾ï¼ˆMaterialized Viewsï¼‰**ï¼šå½“è§†å›¾çš„ç»“æœå­˜å‚¨åœ¨æ•°æ®åº“ç³»ç»Ÿä¸­æ—¶ï¼Œå°±å«åšç‰©åŒ–è§†å›¾ï¼Œç‰©åŒ–è§†å›¾æ— æ³•ç”¨SQLè¿›è¡Œå®šä¹‰ï¼Œè€Œæ˜¯ç”±æ•°æ®åº“è½¯ä»¶ç®¡ç†ä½¿ç”¨ã€‚

#### 3.table

å½“å‰è¡¨å

#### 4.partitions

åŒ¹é…çš„åˆ†åŒº

#### 5.type

å½“å‰è¡¨å†…è®¿é—®æ–¹å¼ï¼Œæ€§èƒ½ç”±å¥½åˆ°åæ’åºï¼š

| id   | type value      | Meaning                                                      |
| ---- | --------------- | ------------------------------------------------------------ |
| 1    | system          | è¡¨ä¸­åªæœ‰ä¸€è¡Œï¼Œconst çš„ä¸€ç§ç‰¹æ®Šæƒ…å†µ                           |
| 2    | const           | å•è¡¨ä¸­æœ€å¤šæœ‰ä¸€ä¸ªåŒ¹é…è¡Œï¼Œprimary key æˆ–è€… unique indexçš„æ£€ç´¢  |
| 3    | eq_ref          | å¤šè¡¨è¿æ¥ä¸­è¢«é©±åŠ¨è¡¨çš„è¿æ¥åˆ—ä¸Šæœ‰primary keyæˆ–è€…unique indexçš„æ£€ç´¢ |
| 4    | ref             | ä¸eq_refç±»ä¼¼ï¼Œä½†ä¸æ˜¯ä½¿ç”¨primary keyæˆ–è€…unique indexï¼Œè€Œæ˜¯æ™®é€šç´¢å¼•ï¼Œæˆ–è€…æ˜¯ç´¢å¼•çš„å·¦å‰ç¼€åºåˆ—ã€‚ç®€è¨€ä¹‹ï¼Œå°±æ˜¯**æ— æ³•æ ¹æ®ç´¢å¼•å€¼ç¡®å®šå•ä¸€è¡Œ**ã€‚ |
| 5    | fulltext        | ä½¿ç”¨FULLTEXTç´¢å¼•æ‰§è¡Œè¿æ¥                                     |
| 6    | ref_or_null     | ä¸refç±»ä¼¼ï¼ŒåŒºåˆ«åœ¨äºæ¡ä»¶ä¸­åŒ…å«å¯¹NULLçš„æŸ¥è¯¢                    |
| 7    | index_merge     | ç´¢å¼•åˆå¹¶ä¼˜åŒ–ï¼Œåˆ©ç”¨ä¸€ä¸ªè¡¨é‡Œçš„Nä¸ªç´¢å¼•æŸ¥è¯¢,key_lenè¡¨ç¤ºè¿™äº›ç´¢å¼•é”®çš„å’Œæœ€é•¿é•¿åº¦ã€‚ |
| 8    | unique_subquery | inçš„åé¢æ˜¯ä¸€ä¸ªæŸ¥è¯¢primary key\uniqueå­—æ®µçš„å­æŸ¥è¯¢             |
| 9    | index_subquery  | inçš„åé¢æ˜¯ä¸€ä¸ªæŸ¥è¯¢æ™®é€šindexå­—æ®µçš„å­æŸ¥è¯¢                      |
| 10   | range           | å•è¡¨ç´¢å¼•ä¸­çš„èŒƒå›´æŸ¥è¯¢,ä½¿ç”¨ç´¢å¼•æŸ¥è¯¢å‡ºå•ä¸ªè¡¨ä¸­çš„ä¸€äº›è¡Œæ•°æ®ã€‚refåˆ—ä¼šå˜ä¸ºnull |
| 11   | index           | ç­‰äºALLï¼Œåªæ˜¯åœ¨éå†æ—¶ä½¿ç”¨äº†ç´¢å¼•æ ‘ã€‚å®ƒæœ‰ä¸¤ç§æƒ…å†µï¼š(1)è¦†ç›–ç´¢å¼• (2)ç”¨ç´¢å¼•çš„é¡ºåºåšä¸€ä¸ªå…¨è¡¨æ‰«æã€‚ |
| 12   | all             | å…¨è¡¨æ‰«æ                                                     |

#### 6.possible_keys

æç¤ºå¯ä»¥ä½¿ç”¨çš„ç´¢å¼•

#### 7.key

å·²ç»ä½¿ç”¨çš„ç´¢å¼•

#### 8.key_len

ç´¢å¼•é•¿åº¦

#### 9.ref

å…³è”åˆ°çš„å¤–éƒ¨è¡¨çš„åˆ—

#### 10.rows

é¢„ä¼°æ‰«æçš„è¡Œæ•°

#### 11.filtered

è¿‡æ»¤æ‰è¡Œçš„ç™¾åˆ†æ¯”

#### 12.Extra

Extraæ˜¯å¯¹æ‰§è¡Œè®¡åˆ’çš„é¢å¤–è¯´æ˜ï¼ŒåŒ…å«é‡è¦ä¿¡æ¯ã€‚ç”±äºè¿‡å¤šï¼Œä¸‹é¢ä¸¾å‡ºé‡è¦çš„ä¼˜åŒ–é¡¹

##### Using filesort

ä½¿ç”¨filesortæ¥è¿›è¡Œorder byæ“ä½œã€‚

Order by æ’åºæ“ä½œæœ‰ä¸¤ç§æ–¹å¼

- ä½¿ç”¨ç´¢å¼•ï¼šå€ŸåŠ©B-Treeè¿›è¡Œå¿«é€Ÿæ’åº
- ä½¿ç”¨filesortï¼šå¤–éƒ¨æ’åºï¼ŒåŸºäºç£ç›˜ä¸å†…å­˜è¿›è¡Œæ’åºï¼Œæ•ˆç‡ä½

ä¼˜åŒ–æ€è·¯ï¼šå»ºç«‹ç´¢å¼•

##### Using temporary

ä½¿ç”¨äº†ä¸´æ—¶è¡¨å»å‚¨å­˜ä¸­é—´ç»“æœï¼Œé€šå¸¸åœ¨Group by å’Œ order by è¯­å¥ä¸­å¸¸è§ã€‚å±äºé‡ç‚¹ä¼˜åŒ–é¡¹ã€‚

##### Using where

ä½¿ç”¨äº†Whereè¿›è¡Œè¿‡æ»¤ï¼Œæ²¡æœ‰ä½¿ç”¨ç´¢å¼•

##### Using Index

æŸ¥è¯¢ä½¿ç”¨äº†è¦†ç›–ç´¢å¼•ï¼Œä¸ç”¨å›è¡¨ï¼ŒæŸ¥è¯¢æ•ˆç‡éå¸¸é«˜ã€‚

ç›¸å…³çš„æœ‰

- **Using index condition**ï¼š
- **Using index for group-by**ï¼šåœ¨Group By ä¸­ä½¿ç”¨äº†ç´¢å¼•ï¼Œä¸ç”¨å»è®¿é—®è¡¨ä¸­æŸ¥æ•°æ®
- **Using index for skip scan**ï¼šä½¿ç”¨äº†Skip Scan ç­–ç•¥

**Using join buffer**

è¡¨æ˜ä½¿ç”¨äº†è¿æ¥ç¼“å­˜,æ¯”å¦‚è¯´åœ¨æŸ¥è¯¢çš„æ—¶å€™ï¼Œå¤šè¡¨`join`çš„æ¬¡æ•°éå¸¸å¤šï¼Œé‚£ä¹ˆå°†é…ç½®æ–‡ä»¶ä¸­çš„ç¼“å†²åŒºçš„`join buffer`è°ƒå¤§ä¸€äº›ã€‚



##### å…¶ä»–

| type value                                          | Meaning                                                      | Suggestion    |
| --------------------------------------------------- | ------------------------------------------------------------ | ------------- |
| const row not found                                 | æ‰€è¦æŸ¥è¯¢çš„è¡¨ä¸ºç©º                                             | SQLå¯èƒ½æœ‰é”™è¯¯ |
| Distinct                                            | mysqlæ­£åœ¨æŸ¥è¯¢distinctå€¼ï¼Œå› æ­¤å½“å®ƒæ¯æŸ¥åˆ°ä¸€ä¸ªdistinctå€¼ä¹‹åå°±ä¼šåœæ­¢å½“å‰ç»„çš„æœç´¢ï¼Œå»æŸ¥è¯¢ä¸‹ä¸€ä¸ªå€¼ | ä¼˜åŒ–ç­–ç•¥      |
| Impossible HAVING                                   | Havingæ¡ä»¶æ€»ä¸ºfalseï¼Œ                                        | SQLå¯èƒ½æœ‰é”™è¯¯ |
| Impossible WHERE                                    | whereæ¡ä»¶æ€»ä¸ºfalse                                           | SQLå¯èƒ½æœ‰é”™è¯¯ |
| Impossible WHERE noticed after reading const tables | åœ¨ä¼˜åŒ–å™¨è¯„ä¼°äº†constè¡¨ä¹‹åï¼Œå‘ç°whereæ¡ä»¶å‡ä¸æ»¡è¶³             | SQLå¯èƒ½æœ‰é”™è¯¯ |
| Not exists                                          | ä¼˜åŒ–å™¨å‘ç°å†…è¡¨è®°å½•ä¸å¯èƒ½æ»¡è¶³whereæ¡ä»¶                        |               |
| Select tables optimized away                        | å¯¹ç´¢å¼•è¿›è¡ŒMINï¼ŒMAXæ“ä½œæ—¶è¿›è¡Œä¼˜åŒ–                             | ä¼˜åŒ–ç­–ç•¥      |

## Reference

- [mysql explain è¯¦è§£](https://weikeqin.com/2020/02/05/mysql-explain/#2-explain%E5%8F%82%E6%95%B0%E8%AF%A6%E8%A7%A3)

- [MySQL explain åº”ç”¨è¯¦è§£(åè¡€æ•´ç†ğŸ¤©)](https://segmentfault.com/a/1190000023565685) å¸¦SQLæ¡ˆä¾‹
- [8.8.2 EXPLAIN Output Format](https://dev.mysql.com/doc/refman/8.0/en/explain-output.html)